<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CMC The Courtyard ‚Äî CMC Finances</title>
<script src="auth.js"></script>
<style>
  :root {
    --cream: #f5f0e8;
    --stone: #b8ad9e;
    --dark: #1e1a16;
    --mid: #6b5f52;
    --accent: #7a5c3e;
    --accent2: #c4956a;
    --border: #ddd5c8;
    --shadow: 0 4px 24px rgba(30,26,22,0.10);
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { font-family: Arial, sans-serif; font-size: 14px; background: var(--cream); color: var(--dark); min-height: 100vh; }

  header {
    background: var(--dark); padding: 1.5rem 2.5rem;
    display: flex; align-items: center; justify-content: space-between;
    flex-wrap: wrap; gap: 1rem;
    border-bottom: 1px solid rgba(196,149,106,0.2);
  }
  .header-brand { display: flex; align-items: center; gap: 1rem; }
  .header-brand h1 { color: var(--cream); font-size: 1.6rem; font-weight: 500; letter-spacing: 0.03em; }
  .header-brand p.sub { color: var(--stone); font-size: 0.78rem; margin-top: 0.1rem; font-weight: 300; letter-spacing: 0.04em; text-transform: uppercase; }
  .header-brand p.greeting { font-size: 0.78rem; color: var(--accent2); font-style: italic; margin-top: 0.2rem; }
  .btn-back {
    padding: 0.5rem 1.1rem; border-radius: 5px; border: 1px solid #3a3530;
    background: transparent; color: var(--stone); font-family: Arial, sans-serif;
    font-size: 0.82rem; cursor: pointer; transition: all 0.2s; letter-spacing: 0.03em;
    text-decoration: none; display: inline-block;
  }
  .btn-back:hover { background: #2a2520; color: var(--accent2); }

  main { max-width: 960px; margin: 3rem auto; padding: 0 1.5rem 4rem; }

  .page-header { margin-bottom: 1.75rem; }
  .page-header h2 { font-size: 1.6rem; font-weight: 500; color: var(--accent); margin-bottom: 0.4rem; }
  .page-header p { color: var(--mid); line-height: 1.6; font-size: 0.88rem; }

  /* ‚îÄ‚îÄ Finance sections ‚îÄ‚îÄ */
  .finance-section { margin-bottom: 2.5rem; }

  .section-heading {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--accent);
    letter-spacing: 0.02em;
    border-bottom: 2px solid var(--border);
    padding-bottom: 0.5rem;
    margin-bottom: 1.2rem;
  }

  /* Collapsible bank-statement button */
  .btn-toggle {
    display: inline-flex;
    align-items: center;
    gap: 0.55rem;
    padding: 0.6rem 1.3rem;
    border-radius: 7px;
    border: 1.5px solid rgba(196,149,106,0.5);
    background: rgba(196,149,106,0.10);
    color: var(--accent);
    font-family: Arial, sans-serif;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.02em;
    margin-bottom: 0.5rem;
  }
  .btn-toggle:hover { background: rgba(196,149,106,0.22); border-color: var(--accent2); color: var(--accent2); }
  .btn-toggle .chevron { display: inline-block; transition: transform 0.25s; font-size: 0.75rem; }
  .btn-toggle.open .chevron { transform: rotate(90deg); }

  /* Collapsible panel */
  .collapsible-panel {
    overflow: hidden;
    max-height: 0;
    transition: max-height 0.35s ease;
  }
  .collapsible-panel.open { max-height: 8000px; }

  /* Doc card (table wrapper) */
  .doc-card {
    background: var(--cream); border: 1px solid var(--border); border-radius: 10px;
    box-shadow: var(--shadow); overflow: hidden; margin-top: 0.6rem;
  }

  /* Sortable table */
  table { width: 100%; border-collapse: collapse; }
  thead th {
    background: rgba(122,92,62,0.07); padding: 0.7rem 1.5rem;
    text-align: left; font-size: 0.75rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: 0.07em; color: var(--mid);
    border-bottom: 1px solid var(--border);
    user-select: none;
  }
  thead th.sortable { cursor: pointer; white-space: nowrap; }
  thead th.sortable:hover { color: var(--accent); }
  thead th .sort-icon { margin-left: 4px; opacity: 0.4; font-size: 0.7rem; }
  thead th.sort-asc .sort-icon::after  { content: ' ‚ñ≤'; opacity: 1; }
  thead th.sort-desc .sort-icon::after { content: ' ‚ñº'; opacity: 1; }
  thead th:not(.sort-asc):not(.sort-desc) .sort-icon::after { content: ' ‚áÖ'; }

  tbody tr { border-bottom: 1px solid var(--border); transition: background 0.15s; }
  tbody tr:last-child { border-bottom: none; }
  tbody tr:hover { background: rgba(196,149,106,0.06); }
  tbody td { padding: 0.85rem 1.5rem; font-size: 0.875rem; }
  .doc-link { color: var(--accent); text-decoration: none; font-weight: 500; word-break: break-word; }
  .doc-link:hover { color: var(--accent2); text-decoration: underline; }
  .td-date { color: var(--mid); font-size: 0.82rem; white-space: nowrap; }

  /* Placeholder sections (Budget, Receipts, Invoices) */
  .placeholder-card {
    background: rgba(196,149,106,0.04);
    border: 1.5px dashed var(--border);
    border-radius: 10px;
    padding: 1.8rem 1.5rem;
    color: var(--stone);
    font-size: 0.88rem;
    text-align: center;
    margin-top: 0.2rem;
  }
  .placeholder-card span { font-size: 1.6rem; display: block; margin-bottom: 0.5rem; opacity: 0.5; }

  .state-empty, .state-loading, .state-error {
    padding: 2.5rem 1.5rem; text-align: center; color: var(--stone); font-size: 0.88rem;
  }
  .state-error { color: #a05050; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .spinner {
    display: inline-block; width: 1.4rem; height: 1.4rem;
    border: 2px solid var(--border); border-top-color: var(--accent2);
    border-radius: 50%; animation: spin 0.7s linear infinite; margin-bottom: 0.6rem;
  }

  @media (max-width: 600px) {
    header { padding: 1rem; }
    main { padding: 1.5rem 1rem 4rem; }
    thead th:nth-child(2), tbody td:nth-child(2) { display: none; }
  }
</style>
</head>
<body>

<header>
  <div class="header-brand">
    <img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QAsRXhpZgAATU0AKgAAAAgAAQExAAIAAAAKAAAAGgAAAABHcmVlbnNob3QA/9sAQwAHBQUGBQQHBgUGCAcHCAoRCwoJCQoVDxAMERgVGhkYFRgXGx4nIRsdJR0XGCIuIiUoKSssKxogLzMvKjInKisq/9sAQwEHCAgKCQoUCwsUKhwYHCoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq/8AAEQgCSANCAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/aAAwDAQACEQMRAD8A+kaKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAoozSZoAWim7xSeYKAH0VEZaaZ6AJ6TcKrG496ja4oAu7hTTIBVE3PvSef70AXDKKUTDFZ5nFJ5/vQBomcUnnis4z+9HnDFAGh54pRMKzTNSib3oA0vOFL5oxWZ53vSfaMd6ANIzCk88VnfaPek8+gDS88U4TjFZnnCl8/3oA0vOFKJQazvPpRPQBo719acDnpWeswp4uMd6ALuaWqYuPepFnoAsUVEJhTxIDQA6igHNFABRRRQAUUUCgAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiikLYoAWiozMBUbTjsaALFMaQCqrXJ/vVCbj1NAFtpwKYZqpmcVC0/PWgC809Rm4qiZ/eozOKAL5uaYZ6z2npPN460AXjPUZnFUzL71E01AF43ApPPrOM1J5/vQBfM9J59UPOppm96ANAz0facVmmb3pRLxQBfNzSfaD2qj5oo870oAu/aGpftHrVDzvejzc0AX/tHvSies/wAygTYoA0RPS+fWeJqXz6ANET0onrOE1OE9AGkJ6d59Zono8/nrQBqiepFn4rJWf3qVJvl60AaonqRZ6y1mp4m96ANVbjFTJOGFZCzVMk3vQBqiUU4Pms1Z/epVn96AL+aKqpPUomFAEtFNDg04HNABRRQDQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUCgAoopPrQAtFJR370ALRSE0tABRSc0hcCgB1NLgVE04FVnn96ALZmAqB7gVTef3qFpvegC08/NQtPVN5veomn96ALbT1CZ6qtNURl60AXDPURn5NVTLTTJQBYM9NMtVWkpDJxQBM0tJ5hqq0ho3tjrQBOZWpPM4quWNGeKAJTJRvqEmkx70AT76aX5qLHvRmgB5elDcVHSZoAl3UFqizTSfm60ATbqXzMVEKM0AS+ZTTJzTM0daAJBJS+ZUeKQ0ATCSneZVfNPXlaAJhJTt9QUbsUAWg9PEuKqB6XOe9AF1ZqeJqojPrTg+KANBZqlWas5ZakEtAGks9SLPWYstTRy0AaaT1Ms2azFmqQTelAGqk+KnScY5rISWp45eKANRZAaeKz0lqdLjHWgCzRUay7qeDQAtFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUU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" alt="CMC Logo" style="height:90px;width:120px;object-fit:cover;border-radius:10px;">
    <div>
      <h1>CMC The Courtyard</h1>
      <p class="sub">Finances</p>
      <p class="greeting" id="welcomeMsg"></p>
    </div>
  </div>
  <div>
    <a class="btn-back" href="main.html">‚¨Ö Back to Home</a>
  </div>
</header>

<main>
  <div class="page-header">
    <h2>CMC Finances</h2>
    <p>Service charge accounts, budgets, invoices, and other financial records for CMC The Courtyard.</p>
  </div>

  <!-- ‚îÄ‚îÄ Bank Statements ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="finance-section">
    <h3 class="section-heading">Bank Statements</h3>

    <!-- Current Account -->
    <button class="btn-toggle" id="toggle-current" onclick="togglePanel('current')" aria-expanded="false">
      <span class="chevron">‚ñ∂</span> Current Account Bank Statements
    </button>
    <div class="collapsible-panel" id="panel-current">
      <div class="doc-card">
        <div id="wrap-current">
          <div class="state-loading"><div class="spinner"></div><div>Loading‚Ä¶</div></div>
        </div>
      </div>
    </div>

    <!-- Other Accounts -->
    <button class="btn-toggle" id="toggle-other" onclick="togglePanel('other')" aria-expanded="false" style="margin-top:0.9rem;">
      <span class="chevron">‚ñ∂</span> Other Accounts Bank Statements
    </button>
    <div class="collapsible-panel" id="panel-other">
      <div class="doc-card">
        <div id="wrap-other">
          <div class="state-loading"><div class="spinner"></div><div>Loading‚Ä¶</div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Budget Documents ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="finance-section">
    <h3 class="section-heading">Budget Documents</h3>
    <div class="placeholder-card">
      <span>üìä</span>
      Budget documents will appear here once uploaded.
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Receipts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="finance-section">
    <h3 class="section-heading">Receipts</h3>
    <div class="placeholder-card">
      <span>üßæ</span>
      Receipts will appear here once uploaded.
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Invoices ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div class="finance-section">
    <h3 class="section-heading">Invoices</h3>
    <div class="placeholder-card">
      <span>üìÑ</span>
      Invoices will appear here once uploaded.
    </div>
  </div>

</main>

<script>
  /* ‚îÄ‚îÄ Greeting ‚îÄ‚îÄ */
  (function() {
    const now = new Date();
    const hour = now.getHours();
    const greeting = hour < 12 ? 'Good morning' : hour < 18 ? 'Good afternoon' : 'Good evening';
    const day = now.toLocaleDateString('en-GB', {weekday:'long', day:'numeric', month:'long'});
    document.getElementById('welcomeMsg').textContent = greeting + ' ‚Äî ' + day;
  })();

  /* ‚îÄ‚îÄ Toggle collapsible panels ‚îÄ‚îÄ */
  function togglePanel(key) {
    const btn   = document.getElementById('toggle-' + key);
    const panel = document.getElementById('panel-' + key);
    const open  = panel.classList.toggle('open');
    btn.classList.toggle('open', open);
    btn.setAttribute('aria-expanded', open);
  }

  /* ‚îÄ‚îÄ Sortable table builder ‚îÄ‚îÄ */
  var tableData = {};   // store parsed rows for re-sort

  function fmtDate(iso) {
    if (!iso) return '‚Äî';
    const d = new Date(iso);
    if (isNaN(d)) return iso;
    return d.toLocaleDateString('en-GB', {day:'numeric', month:'short', year:'numeric'});
  }

  /**
   * Fix display title: replace spaces in date-like segments with hyphens.
   * e.g. "CMC HSBC Current 2014 (2014 01 25 To 2015 01 13)"
   *   -> "CMC HSBC Current 2014 (2014-01-25 To 2015-01-13)"
   */
  function fixTitle(raw) {
    // Remove .pdf extension, convert underscores/hyphens to spaces first
    let s = raw.replace(/\.pdf$/i, '');
    // Inside parentheses, replace space-separated digit groups that look like dates
    s = s.replace(/\(([^)]+)\)/g, function(match, inner) {
      // Replace patterns like "YYYY MM DD" with "YYYY-MM-DD"
      let fixed = inner.replace(/\b(\d{4})\s+(\d{2})\s+(\d{2})\b/g, '$1-$2-$3');
      return '(' + fixed + ')';
    });
    // Title-case the rest (outside parentheses) ‚Äî simple word capitalise
    return s.replace(/\w\S*/g, function(w) {
      return w.charAt(0).toUpperCase() + w.slice(1);
    });
  }

  function buildTable(containerId, files, sortCol, sortDir) {
    if (!files.length) {
      document.getElementById(containerId).innerHTML =
        '<div class="state-empty">No documents uploaded yet.</div>';
      return;
    }

    // Sort
    const sorted = files.slice().sort(function(a, b) {
      let va, vb;
      if (sortCol === 'name') {
        va = fixTitle(a.name).toLowerCase();
        vb = fixTitle(b.name).toLowerCase();
        return sortDir === 'asc' ? va.localeCompare(vb) : vb.localeCompare(va);
      } else {
        va = a.modified ? new Date(a.modified).getTime() : 0;
        vb = b.modified ? new Date(b.modified).getTime() : 0;
        return sortDir === 'asc' ? va - vb : vb - va;
      }
    });

    function thClass(col) {
      if (col !== sortCol) return 'sortable';
      return 'sortable ' + (sortDir === 'asc' ? 'sort-asc' : 'sort-desc');
    }

    let rows = '';
    sorted.forEach(function(f) {
      rows += '<tr>' +
        '<td><a class="doc-link" href="' + f.path + '" target="_blank" rel="noopener">' + fixTitle(f.name) + '</a></td>' +
        '<td class="td-date">' + fmtDate(f.modified) + '</td>' +
        '</tr>';
    });

    document.getElementById(containerId).innerHTML =
      '<table>' +
        '<thead><tr>' +
          '<th class="' + thClass('name') + '" onclick="reSort(\'' + containerId + '\',\'name\')">Document<span class="sort-icon"></span></th>' +
          '<th class="' + thClass('date') + '" onclick="reSort(\'' + containerId + '\',\'date\')">Date<span class="sort-icon"></span></th>' +
        '</tr></thead>' +
        '<tbody>' + rows + '</tbody>' +
      '</table>';
  }

  function reSort(containerId, col) {
    var state = tableData[containerId];
    if (!state) return;
    if (state.sortCol === col) {
      state.sortDir = state.sortDir === 'asc' ? 'desc' : 'asc';
    } else {
      state.sortCol = col;
      state.sortDir = 'asc';
    }
    buildTable(containerId, state.files, state.sortCol, state.sortDir);
  }

  /* ‚îÄ‚îÄ Load index and render ‚îÄ‚îÄ */
  (async function () {
    const INDEX_URL = 'cmcdocuments/index.json';

    try {
      const res = await fetch(INDEX_URL + '?v=' + Date.now());
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const idx = await res.json();

      const folders = idx.folders || [];
      function findFiles(key) {
        const f = folders.find(function(f) { return f.key === key; });
        return f ? (f.files || []) : [];
      }

      // Current Account
      var currentFiles = findFiles('cmccurrentaccount');
      tableData['wrap-current'] = { files: currentFiles, sortCol: 'name', sortDir: 'asc' };
      buildTable('wrap-current', currentFiles, 'name', 'asc');

      // Other Accounts
      var otherFiles = findFiles('cmcotheraccounts');
      tableData['wrap-other'] = { files: otherFiles, sortCol: 'name', sortDir: 'asc' };
      buildTable('wrap-other', otherFiles, 'name', 'asc');

    } catch (err) {
      var msg = '<div class="state-error">‚ö†Ô∏è Could not load documents. Make sure the GitHub Action has run.<br><small>' + err.message + '</small></div>';
      document.getElementById('wrap-current').innerHTML = msg;
      document.getElementById('wrap-other').innerHTML   = msg;
    }
  })();
</script>
</body>
</html>
